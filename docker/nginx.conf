server {
  listen 80;

  gzip on;
  gzip_vary on;
  gzip_proxied any;
  gzip_types
    text/plain
    text/css
    text/js
    text/xml
    text/javascript
    application/javascript
    application/x-javascript
    application/json
    application/xml
    application/rss+xml
    image/svg+xml;

  location /en/ {
    alias /usr/share/nginx/html/en/;
    try_files $uri$args $uri$args/ /en/index.html;
  }

  location /ru/ {
    alias /usr/share/nginx/html/ru/;
    try_files $uri$args $uri$args/ /ru/index.html;
  }

  set $first_language $http_accept_language;
  if ($http_accept_language ~* '^(.+?),') {
    set $first_language $1;
  }

  set $language_suffix 'en';
  if ($first_language ~* 'ru') {
    set $language_suffix 'ru';
  }

  location / {
    rewrite ^/$ /$language_suffix/index.html permanent;
  }
}
